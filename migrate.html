<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Migrate objects.js ‚Üí Firebase</title>
<style>
  body { background:#050308; color:#e8ddd0; font-family:monospace; padding:30px; }
  h2   { color:#F0C85A; margin-bottom:20px; }
  #log { white-space:pre; font-size:13px; line-height:1.8; }
  .ok  { color:#5dbc88; } .err { color:#e07070; } .info { color:#D4A843; }
  button { padding:12px 28px; background:#D4A843; color:#050308; border:none; border-radius:6px; font-size:14px; font-weight:700; cursor:pointer; margin-bottom:24px; }
  button:hover { background:#F0C85A; }
  button:disabled { opacity:0.4; cursor:default; }
</style>
</head>
<body>
<h2>üîÑ Migrate objects.js ‚Üí Master Library Firebase</h2>
<button id="migrateBtn" onclick="startMigrate()">Mulai Migrasi</button>
<div id="log"></div>

<script src="objects.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCa7Gx76AA9GE0bPdCApDMMysrxYdb4gzc",
  authDomain: "wujud-asli.firebaseapp.com",
  databaseURL: "https://wujud-asli-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "wujud-asli",
  storageBucket: "wujud-asli.firebasestorage.app",
  messagingSenderId: "925029041014",
  appId: "1:925029041014:web:ccae53254a649cdb0ab057"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

const log = (msg, cls="") => {
  const d = document.getElementById("log");
  d.innerHTML += `<span class="${cls}">${msg}</span>\n`;
};

window.startMigrate = async () => {
  const btn = document.getElementById("migrateBtn");
  btn.disabled = true;

  // Check existing
  const snap = await get(ref(db, "master/objects"));
  if (snap.exists()) {
    const count = Object.keys(snap.val()).length;
    log(`‚ö†Ô∏è  Master library sudah ada ${count} objek. Lanjut akan MENAMBAHKAN (tidak menimpa).\n`, "err");
  }

  log(`üì¶ Ditemukan ${objects.length} objek di objects.js\n`, "info");

  let ok=0, fail=0;
  for (let i=0; i<objects.length; i++) {
    const obj = objects[i];
    try {
      await push(ref(db,"master/objects"), {
        emoji:       obj.emoji       || "‚ùì",
        name:        obj.name        || "Tanpa Nama",
        category:    obj.category    || "tambahan",
        preview:     obj.preview     || "",
        full_dark:   obj.full_dark   || "",
        full_advice: obj.full_advice || ""
      });
      ok++;
      if (ok % 10 === 0) log(`  ‚úì ${ok}/${objects.length} ‚Äî ${obj.emoji} ${obj.name}`, "ok");
    } catch(e) {
      fail++;
      log(`  ‚úó Gagal: ${obj.name} ‚Äî ${e.message}`, "err");
    }
  }

  log(`\nüéâ Selesai! ${ok} berhasil, ${fail} gagal.`, "ok");
  log(`\n‚úÖ Master library siap! User baru akan otomatis dapat data ini saat aktivasi.`, "info");
  log(`‚Üí Untuk user yang sudah ada: buka admin.html ‚Üí tab Master Library ‚Üí Push Update`, "info");
  btn.textContent = "‚úì Selesai";
};
</script>
</body>
</html>

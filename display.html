<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#080507">
<title>Wujud Asli — Display</title>
<link rel="manifest" href="/manifest-display.json">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cinzel+Decorative:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --dark: #080507;
    --blood: #8b0000;
    --gold: #c9a84c;
    --gold-bright: #e8c96a;
    --text: #e8ddd0;
    --faded: #6a5a55;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    padding: 15vh 0;
    width: 100%; height: 100%;
    background: var(--dark);
    overflow: hidden;
  }
  body {
    display: flex; align-items: center; justify-content: center;
    background: radial-gradient(ellipse at center, #160b0f 0%, #080507 75%);
    position: relative;
  }
  body::before {
    content: "";
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse at 15% 15%, rgba(139,0,0,0.12) 0%, transparent 45%),
      radial-gradient(ellipse at 85% 85%, rgba(139,0,0,0.08) 0%, transparent 45%),
      radial-gradient(ellipse at 50% 50%, rgba(80,0,30,0.15) 0%, transparent 60%);
    pointer-events: none;
  }

  /* TITLE */
  .panel-title {
    position: absolute; top: 0; left: 0; right: 0;
    text-align: center; padding: 18px 0 14px; z-index: 10;
    border-bottom: 1px solid rgba(201,168,76,0.12);
    background: linear-gradient(to bottom, rgba(8,5,7,0.95), transparent);
  }
  .panel-title-main {
    font-family: "Cinzel Decorative", serif; font-size: 16px;
    color: var(--gold); letter-spacing: 8px;
    text-shadow: 0 0 25px rgba(201,168,76,0.6), 0 0 50px rgba(201,168,76,0.2);
  }
  .panel-title-sub { font-family: "Cinzel", serif; font-size: 9px; letter-spacing: 5px; color: var(--faded); margin-top: 5px; }

  /* CORNERS */
  .corner-svg { position: absolute; opacity: 0.2; z-index: 5; }
  .corner-svg.tl { top: 60px; left: 15px; }
  .corner-svg.tr { top: 60px; right: 15px; transform: scaleX(-1); }
  .corner-svg.bl { bottom: 60px; left: 15px; transform: scaleY(-1); }
  .corner-svg.br { bottom: 60px; right: 15px; transform: scale(-1); }

  /* STAGE */
  .object-stage {
    position: relative; width: min(340px, 80vw); height: min(340px, 80vw);
    display: flex; align-items: center; justify-content: center; z-index: 5;
  }
  .ring { position: absolute; border-radius: 50%; }
  .ring-1 { width: 76%; height: 76%; animation: spin 25s linear infinite; border: 1px solid rgba(201,168,76,0.12); }
  .ring-2 { width: 91%; height: 91%; animation: spin 35s linear infinite reverse; border: 1px dashed rgba(139,0,0,0.2); }
  .ring-3 { width: 109%; height: 109%; animation: spin 50s linear infinite; border: 1px solid rgba(201,168,76,0.06); }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .object-glow {
    position: absolute; width: 74%; height: 74%; border-radius: 50%;
    background: radial-gradient(ellipse, rgba(139,0,0,0.3) 0%, rgba(80,0,20,0.1) 50%, transparent 70%);
    animation: pulse-glow 3s ease-in-out infinite; z-index: 1;
  }
  @keyframes pulse-glow { 0%,100% { opacity:0.6; transform:scale(1); } 50% { opacity:1; transform:scale(1.15); } }

  /* STATES */
  .state { position: absolute; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; gap: 14px; text-align: center; padding: 20px; z-index: 3; }
  .state.active { display: flex; }

  /* IDLE */
  .idle-symbol { font-size: clamp(28px,6vw,42px); color: var(--gold); letter-spacing: 12px; animation: float-idle 4s ease-in-out infinite; opacity: 0.3; }
  @keyframes float-idle { 0%,100% { transform:translateY(0); opacity:0.3; } 50% { transform:translateY(-8px); opacity:0.5; } }
  .idle-text-main { font-family: "Cinzel", serif; font-size: clamp(11px,2.5vw,15px); letter-spacing: 2px; color: var(--gold); line-height: 2; opacity: 0.8; text-shadow: 0 0 20px rgba(201,168,76,0.3); }
  .idle-text-sub { font-family: "Crimson Text", serif; font-style: italic; font-size: clamp(11px,2vw,13px); color: var(--faded); animation: flicker 5s ease-in-out infinite; }
  @keyframes flicker { 0%,85%,100%{opacity:0.5;} 90%{opacity:0.15;} 93%{opacity:0.7;} 96%{opacity:0.2;} }

  /* SCANNING */
  .scan-label { font-family: "Cinzel", serif; font-size: 9px; letter-spacing: 5px; color: var(--faded); text-transform: uppercase; }
  .scan-name { font-family: "Cinzel", serif; font-size: clamp(16px,4vw,26px); letter-spacing: 5px; color: var(--gold-bright); text-shadow: 0 0 30px rgba(232,201,106,0.8); animation: name-pulse 1.2s ease-in-out infinite; }
  @keyframes name-pulse { 0%,100%{opacity:1;} 50%{opacity:0.65; text-shadow:0 0 60px rgba(232,201,106,1),0 0 100px rgba(139,0,0,0.5);} }
  .scan-bar-wrap { width: 180px; height: 2px; background: rgba(201,168,76,0.1); border-radius: 2px; overflow: hidden; position: relative; }
  .scan-bar { height:100%; width:40%; background:linear-gradient(to right,transparent,var(--gold),transparent); position:absolute; animation:scan-move 1.4s ease-in-out infinite; }
  @keyframes scan-move { 0%{left:-40%;} 100%{left:140%;} }
  .scan-dots { font-family:"Cinzel",serif; font-size:11px; letter-spacing:4px; color:rgba(139,0,0,0.8); text-transform:uppercase; }
  .scan-dots span { animation:dot-blink 1.4s ease-in-out infinite; }
  .scan-dots span:nth-child(2){animation-delay:0.2s;}
  .scan-dots span:nth-child(3){animation-delay:0.4s;}
  @keyframes dot-blink { 0%,100%{opacity:0.2;} 50%{opacity:1;} }

  /* REVEALED */
  .object-emoji {
    font-size: clamp(100px, 22vw, 160px); line-height: 1;
    filter: drop-shadow(0 0 30px rgba(139,0,0,0.6)) drop-shadow(0 0 70px rgba(139,0,0,0.2));
    animation: obj-float 3s ease-in-out infinite;
  }
  @keyframes obj-float {
    0%,100%{transform:translateY(0) scale(1) rotate(-2deg);}
    50%{transform:translateY(-12px) scale(1.05) rotate(2deg); filter:drop-shadow(0 0 50px rgba(139,0,0,0.9)) drop-shadow(0 0 100px rgba(201,168,76,0.2));}
  }
  .revealed-name { font-family:"Cinzel",serif; font-size:clamp(12px,2.5vw,18px); letter-spacing:6px; color:var(--gold); text-shadow:0 0 20px rgba(201,168,76,0.5); }

  /* BOTTOM NAME */
  .name-tag { position:absolute; bottom:0; left:0; right:0; text-align:center; padding:12px 0 16px; border-top:1px solid rgba(201,168,76,0.08); background:linear-gradient(to top,rgba(8,5,7,0.95),transparent); z-index:10; }
  .name-tag-text { font-family:"Cinzel",serif; font-size:9px; letter-spacing:5px; color:var(--faded); text-transform:uppercase; }

  /* CONNECTION STATUS */
  .conn-dot { position:absolute; top:12px; right:12px; width:8px; height:8px; border-radius:50%; background:#333; z-index:20; transition:background 0.3s; }
  .conn-dot.connected { background:#2d5a1b; box-shadow:0 0 6px rgba(45,90,27,0.8); }
  .conn-dot.disconnected { background:#8b0000; animation:blink-red 1s infinite; }
  @keyframes blink-red { 0%,100%{opacity:1;} 50%{opacity:0.3;} }
</style>
</head>
<body>

<div class="panel-title">
  <div class="panel-title-main">Wujud Asli</div>
  <div class="panel-title-sub">Pembacaan Jiwa</div>
</div>

<svg class="corner-svg tl" width="65" height="65" viewBox="0 0 65 65" fill="none"><path d="M5 5 L5 35 M5 5 L35 5" stroke="#c9a84c" stroke-width="1.5"/><path d="M5 5 L22 22" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/><circle cx="5" cy="5" r="2.5" fill="#c9a84c" opacity="0.6"/><circle cx="22" cy="22" r="1.5" fill="#c9a84c" opacity="0.3"/><path d="M14 5 L14 14 L5 14" stroke="#c9a84c" stroke-width="0.6" opacity="0.35"/></svg>
<svg class="corner-svg tr" width="65" height="65" viewBox="0 0 65 65" fill="none"><path d="M5 5 L5 35 M5 5 L35 5" stroke="#c9a84c" stroke-width="1.5"/><path d="M5 5 L22 22" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/><circle cx="5" cy="5" r="2.5" fill="#c9a84c" opacity="0.6"/><circle cx="22" cy="22" r="1.5" fill="#c9a84c" opacity="0.3"/><path d="M14 5 L14 14 L5 14" stroke="#c9a84c" stroke-width="0.6" opacity="0.35"/></svg>
<svg class="corner-svg bl" width="65" height="65" viewBox="0 0 65 65" fill="none"><path d="M5 5 L5 35 M5 5 L35 5" stroke="#c9a84c" stroke-width="1.5"/><path d="M5 5 L22 22" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/><circle cx="5" cy="5" r="2.5" fill="#c9a84c" opacity="0.6"/><circle cx="22" cy="22" r="1.5" fill="#c9a84c" opacity="0.3"/><path d="M14 5 L14 14 L5 14" stroke="#c9a84c" stroke-width="0.6" opacity="0.35"/></svg>
<svg class="corner-svg br" width="65" height="65" viewBox="0 0 65 65" fill="none"><path d="M5 5 L5 35 M5 5 L35 5" stroke="#c9a84c" stroke-width="1.5"/><path d="M5 5 L22 22" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/><circle cx="5" cy="5" r="2.5" fill="#c9a84c" opacity="0.6"/><circle cx="22" cy="22" r="1.5" fill="#c9a84c" opacity="0.3"/><path d="M14 5 L14 14 L5 14" stroke="#c9a84c" stroke-width="0.6" opacity="0.35"/></svg>

<div class="object-stage">
  <div class="ring ring-1"></div>
  <div class="ring ring-2"></div>
  <div class="ring ring-3"></div>
  <div class="object-glow"></div>

  <div class="state active" id="stateIdle">
    <div class="idle-symbol">☽ ✦ ☾</div>
    <div class="idle-text-main">Ketikkan namamu<br>untuk mengetahui<br>wujud aslimu</div>
    <div class="idle-text-sub">— bisikkan namamu kepada malam —</div>
  </div>

  <div class="state" id="stateScanning">
    <div class="scan-label">Membaca jiwa</div>
    <div class="scan-name" id="scanName"></div>
    <div class="scan-bar-wrap"><div class="scan-bar"></div></div>
    <div class="scan-dots">Menelusuri<span>.</span><span>.</span><span>.</span></div>
  </div>

  <div class="state" id="stateRevealed">
    <div class="object-emoji" id="objectEmoji"></div>
    <div class="revealed-name" id="revealedName"></div>
  </div>
</div>

<div class="name-tag"><div class="name-tag-text" id="nameTagBottom">✦ &nbsp; ✦ &nbsp; ✦</div></div>
<div class="conn-dot" id="connDot" title="Firebase connection"></div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCa7Gx76AA9GE0bPdCApDMMysrxYdb4gzc",
    authDomain: "wujud-asli.firebaseapp.com",
    databaseURL: "https://wujud-asli-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "wujud-asli",
    storageBucket: "wujud-asli.firebasestorage.app",
    messagingSenderId: "925029041014",
    appId: "1:925029041014:web:ccae53254a649cdb0ab057"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);
  const connDot = document.getElementById("connDot");

  // Monitor connection
  onValue(ref(db, ".info/connected"), snap => {
    connDot.className = "conn-dot " + (snap.val() ? "connected" : "disconnected");
  });

  // ---- State management ----
  const FADE_DURATION   = 900;
  const REVEAL_DURATION = 6000;
  let revealTimer = null;

  function setPanel(state) {
    ["stateIdle","stateScanning","stateRevealed"].forEach(id => {
      document.getElementById(id).classList.remove("active");
    });
    document.getElementById(state).classList.add("active");
  }

  function doRevealAnimation(emoji, name) {
    const emojiEl = document.getElementById("objectEmoji");
    const nameEl  = document.getElementById("revealedName");
    emojiEl.textContent = emoji;
    nameEl.textContent  = name.toUpperCase();
    emojiEl.style.animation  = "none";
    emojiEl.style.opacity    = "0";
    emojiEl.style.transform  = "scale(0.15) rotate(-20deg)";
    emojiEl.style.transition = "";
    setPanel("stateRevealed");
    requestAnimationFrame(() => requestAnimationFrame(() => {
      emojiEl.style.transition = "opacity 0.8s cubic-bezier(0.34,1.56,0.64,1), transform 0.8s cubic-bezier(0.34,1.56,0.64,1)";
      emojiEl.style.opacity    = "1";
      emojiEl.style.transform  = "scale(1) rotate(0deg)";
      setTimeout(() => {
        emojiEl.style.transition = "";
        emojiEl.style.animation  = "obj-float 3s ease-in-out infinite";
      }, 850);
    }));
  }

  // Listen to Firebase state changes
  let lastState = null;
  onValue(ref(db, "session"), snap => {
    const data = snap.val();
    if (!data) return;

    // Avoid re-processing same state
    const stateKey = data.state + (data.name||"") + (data.emoji||"") + (data.ts||"");
    if (stateKey === lastState) return;
    lastState = stateKey;

    if (revealTimer) { clearTimeout(revealTimer); revealTimer = null; }

    if (data.state === "idle") {
      setPanel("stateIdle");
      document.getElementById("nameTagBottom").textContent = "✦ \u00A0 ✦ \u00A0 ✦";

    } else if (data.state === "scanning") {
      document.getElementById("scanName").textContent = (data.name||"").toUpperCase();
      document.getElementById("nameTagBottom").textContent = (data.name||"").toUpperCase();
      setPanel("stateScanning");

    } else if (data.state === "revealed") {
      document.getElementById("nameTagBottom").textContent = (data.name||"").toUpperCase();
      doRevealAnimation(data.emoji, data.name||"");
      // Auto back to idle after REVEAL_DURATION
      revealTimer = setTimeout(() => {
        setPanel("stateIdle");
        document.getElementById("nameTagBottom").textContent = "✦ \u00A0 ✦ \u00A0 ✦";
      }, REVEAL_DURATION + FADE_DURATION);
    }
  });
</script>

<!-- PWA service worker -->
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").catch(() => {});
  }
</script>
</body>
</html>
